<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOIL NUTRIENT DASHBOARD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #000000 50%, #0f3d05 40%); color: #000000; line-height: 1.6; }
        .navbar { background: #0f3d05; padding: 1rem 2rem; box-shadow: 0 2px 10px #ebd5ab; position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #ebd5ab; display: flex; align-items: center; gap: 0.8rem; }
        .logo img { height: 45px; width: 45px; border-radius: 8px; object-fit: cover; box-shadow: 0 0 15px rgba(65, 203, 0, 0.6); transition: all 0.5s ease; }
        .logo img:hover { transform: rotate(360deg) scale(1.1); box-shadow: 0 0 25px rgba(65, 203, 0, 0.9); }
        .uni-logo { height: 45px; width: 45px; border-radius: 8px; object-fit: cover; }
        .logo-container { display: flex; align-items: center; gap: 1rem; }
        .logo-text { display: flex; align-items: center; gap: 0.5rem; }
        .nav-links { display: flex; gap: 2rem; list-style: none; }
        .nav-links a { text-decoration: none; color: #fff; font-weight: 500; transition: color 0.3s; }
        .nav-links a:hover { color: #f8ee93; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .hero { text-align: center; padding: 2rem; color: #f8ee93; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 300px; background-image: url('inotek-logo.png'); background-size: contain; background-repeat: no-repeat; background-position: center; opacity: 0.15; filter: blur(2px); z-index: 0; pointer-events: none; }
        .hero h1, .hero p { position: relative; z-index: 1; }
        .section { background: #ffe482; border-radius: 15px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .section h2 { color: #108401; margin-bottom: 1.5rem; border-bottom: 3px solid #108401; padding-bottom: 0.5rem; }
        
        .sensor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; }
        .sensor-card { background: linear-gradient(135deg, #41cb00 0%, #0e7001 100%); color: #f8ee93; padding: 1.5rem; border-radius: 10px; text-align: center; transition: transform 0.3s; }
        .sensor-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .sensor-value { font-size: 2.2rem; font-weight: bold; }
        
        .history-container { overflow-x: auto; margin-top: 1rem; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #628141; color: white; }
        tr:hover { background: #f5f5f5; }

        .btn { background: #017603; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 1rem; transition: all 0.3s; }
        .btn:hover { background: #08aa15; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(1, 118, 3, 0.3); }
        .chart-container { height: 300px; margin-top: 2rem; }

        .media-wrapper { text-align: center; }
        .media-wrapper img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        /* Video Showcase Styling */
        .video-showcase { display: grid; grid-template-columns: 1fr; gap: 2rem; }
        .video-container-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); background: #000; }
        .video-container-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 15px; }
        .video-description { background: linear-gradient(135deg, #f8ee93 0%, #ebd5ab 100%); padding: 1.5rem; border-radius: 10px; border-left: 5px solid #108401; }
        .video-description h3 { color: #108401; margin-bottom: 1rem; font-size: 1.3rem; }
        .video-description p { color: #333; line-height: 1.8; margin-bottom: 1rem; }
        .video-features { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; }
        .feature-tag { background: #017603; color: white; padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s; }
        .feature-tag:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); background: #08aa15; }
        
        @media (min-width: 768px) {
            .video-showcase { grid-template-columns: 2fr 1fr; }
        }
        
        .status-badge { padding: 0.3rem 0.8rem; border-radius: 5px; font-weight: bold; }
        .status-good { background: #4db24d; color: white; }
        .status-warning { background: #ffaa00; color: white; }
        .status-bad { background: #ff4d4d; color: white; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="logo-container">
                <!-- Logo University (Sebelah Kiri) -->
                <img src="utem-logo.png" alt="University Logo" class="uni-logo">
                
                <!-- Logo Soil Nutrient (Tengah) -->
                <div class="logo">
                    <img src="logochill.png" alt="Logo">
                    <div class="logo-text">
                        <span>Soil Nutrient Website</span>
                    </div>
                </div>
            </div>
            <ul class="nav-links">
                <li><a href="#poster">Poster</a></li>
                <li><a href="#video">Video</a></li>
                <li><a href="#dashboard">Dashboard</a></li>
                <li><a href="#history">History</a></li>
                <li><a href="#visualization">Trends</a></li>
            </ul>
        </div>
    </nav>

    <div class="hero">
        <h1>IOT-ENABLED SOIL NUTRIENT CLASSIFICATION AND CROP RECOMMENDATION</h1>
        <p>Real-time NPK & pH Monitoring</p>
    </div>

    <div class="container">
        <section id="poster" class="section">
            <h2>üìã INOTEK POSTER</h2>
            <div class="media-wrapper">
                <img src="inotekposter.png" alt="INOTEK POSTER">
            </div>
        </section>

        <section id="video" class="section">
            <h2>üé• VIDEO INOTEK</h2>
            <div class="video-showcase">
                <div class="video-container-wrapper">
                    <iframe 
                        src="https://www.youtube.com/embed/NQ72qXsxWMU?rel=0&modestbranding=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="video-description">
                    <h3>üìå About This Project</h3>
                    <p>Watch our complete IoT-enabled soil nutrient Classification and Crop Recommendation in action.</p>
                    <div class="video-features">
                        <span class="feature-tag">‚ö° Real-time Monitoring</span>
                        <span class="feature-tag">üåæ Crop Optimization</span>
                        <span class="feature-tag">‚òÅÔ∏è Cloud Connected</span>
                        <span class="feature-tag">üå± Smart Agriculture</span>
                        <span class="feature-tag">üî¨ Soil Analysis</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard" class="section">
            <h2>üìä REAL TIME DATA </h2>
            <div class="sensor-grid">
                <div class="sensor-card"><h3>Nitrogen (N)</h3><div id="n-value" class="sensor-value">--</div><small>mg/kg</small></div>
                <div class="sensor-card"><h3>Phosphorus (P)</h3><div id="p-value" class="sensor-value">--</div><small>mg/kg</small></div>
                <div class="sensor-card"><h3>Potassium (K)</h3><div id="k-value" class="sensor-value">--</div><small>mg/kg</small></div>
                <div class="sensor-card"><h3>pH Level</h3><div id="ph-value" class="sensor-value">--</div><small>pH</small></div>
                <div class="sensor-card"><h3>Moisture</h3><div id="moisture-value" class="sensor-value">--</div><small>%</small></div>
                <div class="sensor-card"><h3>Temp</h3><div id="temp-value" class="sensor-value">--</div><small>¬∞C</small></div>
            </div>
            <button class="btn" onclick="saveToHistory()">üíæ SAVE TO HISTORY</button>
        </section>

        <section id="history" class="section">
            <h2>üìú HISTORY </h2>
            <div class="history-container">
                <table>
                    <thead>
                        <tr>
                            <th>N</th>
                            <th>P</th>
                            <th>K</th>
                            <th>pH</th>
                            <th>Moisture</th>
                            <th>Temp</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="history-body"></tbody>
                </table>
            </div>
        </section>

        <section id="visualization" class="section">
            <h2>üìä NUTRIENT TRENDS</h2>
            <div class="chart-container"><canvas id="nutrientChart"></canvas></div>
        </section>
    </div>

    <script>
        // KONFIGURASI FIREBASE
        const BASE_URL = 'https://nutriensoilapp-default-rtdb.asia-southeast1.firebasedatabase.app';
        const API_KEY = '4xzx4NgjeTSLmkFjpcd3NYZgyftmyH2xbNRmssD3';

        let currentData = null;
        let nutrientChart;

        // 1. Ambil data LIVE dari folder /soil
        async function fetchLiveSensor() {
            try {
                const response = await fetch(`${BASE_URL}/soil.json?auth=${API_KEY}`);
                const data = await response.json();
                
                console.log("Data dari Firebase:", data); // Debug
                
                if (data) {
                    currentData = data;
                    document.getElementById('n-value').innerText = data.N || 0;
                    document.getElementById('p-value').innerText = data.P || 0;
                    document.getElementById('k-value').innerText = data.K || 0;
                    document.getElementById('ph-value').innerText = data.ph || 0;
                    document.getElementById('moisture-value').innerText = data.moisture || 0;
                    document.getElementById('temp-value').innerText = data.temperature || 0;
                }
            } catch (e) { 
                console.error("Error Fetch:", e); 
            }
        }

        // 2. Simpan data ke folder /history
        async function saveToHistory() {
            if (!currentData) return alert("Tiada data!");

            const entry = {
                N: currentData.N,
                P: currentData.P,
                K: currentData.K,
                ph: currentData.ph,
                moisture: currentData.moisture,
                temperature: currentData.temperature,
                status: currentData.status || 'Normal',
                time: new Date().toLocaleString()
            };

            try {
                await fetch(`${BASE_URL}/history.json?auth=${API_KEY}`, {
                    method: 'POST',
                    body: JSON.stringify(entry)
                });
                alert("Data disimpan!");
                loadHistory();
            } catch (e) { 
                alert("Gagal simpan!"); 
                console.error(e);
            }
        }

        // 3. Papar Sejarah dari folder /history
        async function loadHistory() {
            try {
                const response = await fetch(`${BASE_URL}/history.json?auth=${API_KEY}`);
                const data = await response.json();
                const tbody = document.getElementById('history-body');
                tbody.innerHTML = "";
                
                if (data) {
                    const entries = Object.entries(data).reverse().slice(0, 10); // 10 latest
                    entries.forEach(([id, h]) => {
                        tbody.innerHTML += `<tr>
                            <td>${h.N}</td>
                            <td>${h.P}</td>
                            <td>${h.K}</td>
                            <td>${h.ph}</td>
                            <td>${h.moisture || '-'}</td>
                            <td>${h.temperature || '-'}</td>
                            <td><span class="status-badge status-good">${h.status || 'Normal'}</span></td>
                        </tr>`;
                    });
                    
                    updateChart(entries);
                }
            } catch (e) { 
                console.error("Error load history:", e);
            }
        }

        // 4. Update Chart dengan data history
        function updateChart(entries) {
            if (!nutrientChart) return;
            
            const labels = [];
            const nData = [];
            const pData = [];
            const kData = [];
            
            entries.slice(0, 5).reverse().forEach(([id, h]) => {
                labels.push(h.time.split(',')[1] || h.time); // Ambil masa sahaja
                nData.push(h.N || 0);
                pData.push(h.P || 0);
                kData.push(h.K || 0);
            });
            
            nutrientChart.data.labels = labels;
            nutrientChart.data.datasets[0].data = nData;
            nutrientChart.data.datasets[1].data = pData;
            nutrientChart.data.datasets[2].data = kData;
            nutrientChart.update();
        }

        // 5. Initialize Chart (LINE CHART)
        function initChart() {
            const ctx = document.getElementById('nutrientChart').getContext('2d');
            nutrientChart = new Chart(ctx, {
                type: 'line',
                data: { 
                    labels: [],
                    datasets: [
                        { 
                            label: 'N (mg/kg)', 
                            borderColor: '#ff4d4d',
                            backgroundColor: 'rgba(255, 77, 77, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 2,
                            data: [] 
                        },
                        { 
                            label: 'P (mg/kg)', 
                            borderColor: '#4d79ff',
                            backgroundColor: 'rgba(77, 121, 255, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 2,
                            data: [] 
                        },
                        { 
                            label: 'K (mg/kg)', 
                            borderColor: '#4db24d',
                            backgroundColor: 'rgba(77, 178, 77, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 2,
                            data: [] 
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Nutrient Trends (Last 5 Readings)'}
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // 6. Auto-refresh setiap 5 saat
        function startAutoRefresh() {
            fetchLiveSensor();
            loadHistory();
            setInterval(fetchLiveSensor, 5000); // Update setiap 5 saat
        }

        // Jalankan apabila page load
        window.onload = function() {
            initChart();
            startAutoRefresh();
        };
    </script>
</body>
</html>